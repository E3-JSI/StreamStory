<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>ProaSense - UI</title>
	
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="lib/jquer-ui.css">	
	
	<script type="text/javascript" src="lib/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="lib/cytoscape.js"></script>
	<script type="text/javascript" src="viz/zoomvis.js"></script>
	
	<script type="text/javascript">
		var viz;
		var ws;
		var msgs = [];
	
		function drawMsgs() {
			$('#list-msg').html('');
			
			$.each(msgs, function (i, msg) {
				$('#list-msg').append('<li class="li-msg">' + msg + '</li>');
			});
		}
	
		function initWs() {
			var address = location.host + '/websocket';
			
			console.log('Connecting websocket to address: ' + address); 
			ws = new WebSocket('ws://' + address);
			
			ws.onopen = function () {
       			console.log('Web socket connected!');
   			};
   			
   			ws.onerror = function (e) {
   				console.log('Web socket error: ' + e);
   				alert('Web socket error!');
   			};
   			
   			ws.onmessage = function (msgStr) {
   				var msg = JSON.parse(msgStr.data);
   				
   				if (msg.type == 'stateChanged')
   					viz.setCurrentStates(msg.content);
   				else if (msg.type == 'anomaly') {
   					msgs.push(msg.content);
   					drawMsgs();
  				}
   			};
		}
	
		$(document).ready(function () {
			viz = zoomVis({
				//url: 'data/podatki.json',
				url: '/drilling/multilevel',
				visContainer: 'vis_container',
				currentHeightContainer: 'current_height_value'
			});
			
			viz.refresh();
			initWs();
		});
	</script>
</head>
<body>
	<div id="container-center">
		<div id="container-left">
			<div id="parent_container" class="container">
				<div id="slider_container">
					<div id="slider_item_div"></div>
				</div>
				<div id="vis_container"></div>
			</div>
			<div id="container-details" class="container"></div>
		</div>
		<div id="container-right">
			<div id="container-msg" class="container">
				<ul class="list-msg"></ul>
			</div>
			<div id="container-config" class="container">
				<div id="current_height_value"></div>
			</div>
		</div>
	</div>
</body>